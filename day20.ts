const inputAlgo = `#.#....########.......##..##.#.#####...#..#..##.###.##.#..##.....#.#....#...####.#...#.##.#.#.#....###...#.##.#...#.#....#...#.#..#....###.##.....#.######.#.##.#..####..#...#.##.##...#....###..#.##..###..#..#.....#.###.##....##...#....###.#.......#.#####...#.##..###....##.#.##..##.######...##..##.#..###.###.....###...##.##.#..#...##..#.###..#..###..##...#...#.#..#..#..##....###...........###.#....#######...#####.#..##...#..#....##.##.#.###...####...#.#..#...#.##.#.#..#.###.#.#####.#.##.###.##..#..#...###.#.`;
const inputAlgoEx = `..#.#..#####.#.#.#.###.##.....###.##.#..###.####..#####..#....#..#..##..###..######.###...####..#..#####..##..#.#####...##.#.#..#.##..#.#......#.###.######.###.####...#.##.##..#..#..#####.....#.#....###..#.##......#.....#..#..#..##..#...##.######.####.####.#.#...#.......#..#.#.#...####.##.#......#..#...##.#.##..#...##.#.##..###.#......#.#.......#.#.#.####.###.##...#.....####.#..#..#.##.#....##..#.####....##...##..#...#......#.#.......#.......##..####..#...#.#.#...##..#.#..###..#####........#..####......#..#`;

const inputImg = `.#.#.##.#######..#..#..#.#.#...###.###.##..##..##.###..#.#...##..##....##....#..####.#.###..#.#.#..#
#..###.##.........#..#.#...#......###..##.#.####....#..#..###.#.#######...###..#.#.##.#..##.#.#.....
.###..##.##..#.#.####.#.##..##.#.##.#..#####.#..#....#....#....#...#.##..###.#.####...##..##.##.#...
##....##....#.#.#...#..####..#..#.#.#.##.#.#.##..##.#..#...#..##...##...#.#.##.....##.####....#.....
#......#....#.###.##...#.#..#.#.#.##..###..##..###.##..##...####..#.#.#..##..#..#.#.#...###.......##
##.##...###.#.##..#######..#.###.###.##.....#.#...###..#####...#.###.#.#######.##....#.#.###..##..#.
..#.###....#.#.#..##..#.###.#.##.###.#..##.#...#...#......#####......###.##..#..##....#....#...#...#
#.##.##...#.#.#.#..##..#.#.##.#...#.###..#.####.##.#.#..#####...####..##..##..#.####.###..####.#..##
#####...#.####....##....##.........#.###.#...#..###.#........#.###.#...#.#.###########..#####..##...
..#.####..##.##.#..#.#####.##.#.#.#..######..####.#.#.#.##...#.#.#.#..##..###.###...#.....#.###...##
..#.....#.#.#..##..####.###.##.#.##.#.#...#.#####.#.#....##.#.#....##.#.##.#.##.##.#.#...#.....##.##
#..##....##...##...######.####.##....#..#.#.###.#.###..#.###......##.###....######.##.#...##...###..
##..#....###.##..#.#..########......##..#.#.##...#.##.#..#..#.##.###.#...#....#.##.#..#####.#..#.#.#
..#..#..######..#.##......#....#.#.#..#.##.##..##...#....###.##..#..###.##..##......##..#.#..###.##.
....#.####.##.#####.###.##..#.#####.###.....#.#..#########.##.##..###.##.#.#..#.....#####.###.#.#..#
...#..#.#.#.#.#.#######...#.#.####.##..##.....##..#####..#..#.##.#..##...#.##.##..#..........##.#.##
...#.###.##.####...##.###.#####.####.....##.#.##...#..#..###.###.#.........###.#####.....#.##..#.#..
.##.#.#.#.....#.#.##.#.#....#.###..####...#....##.#.#####.#...##...####..#...#######...####..#....##
##.#.###.#..###..###...####.#.###.####...#..#.##.......#...#.#........#..#..##.....#.##...###.#..#..
##.#.#..#........##..######.#######.######..##.#..##.#......#.###.#..#..##..###.........#.#######.#.
#.###.###...#.#.##.#########....#..#.#####.#.##.##..#..#.#.....##.#..###.#....###.###...#.#...##..#.
#.##.####..##....##...#.#...#.##.#..##.###..##..#####.#...#.#.......#..#.###....#..#..##.....#.###..
#.###.#.#.#...##..#.#.##...###..#.##........#.##.####.#..####.#.#.###.##....#.##.######.####.###....
.####...#..#..#.#..####..##..#.#.....##.#..##...#.#.#.#...##....#......##...#..#.###.#...##..#.####.
..####...#.#....###..#.#..#....##..#..#.#..####.#.##..##.###...##..#..#######.#.#######......####...
#.#..#..###.#.##.###..###.##.#.###.#####.#..#.#####.#.##.#..#.########..###..#...#.###..##..#.#..###
######...#....#....#......#......#.##.######...#.......#..#..##..#..##.#..#..####..##....##.##..#.#.
#....###.#.######.###..##.#..###..#..#..###.#.....#.#.##..###..#.#..##.###.#..#..#.#.#..##.##.#.####
#..#..#####.##...##.#..#######.#.#.#..###.#.##.###..#....####...####..##..##..#...#...#..#..#.#..#..
...#....##...####.#.##.#.#.#.......#..##....###.##..#...##...##.#.#.#.#.###..###..##..#.....##....##
#.#.#######..###...###.##.#..#..###.#####.###.#.#..##...#.##..####...##..#.##...#.##.#####.##.......
.#...#......##..#.#.##...###.##.#.##....####.##.#####.##.#..#.#..##....#.#.#..######....#.###.#####.
#..#.##..###..#.##.#....##..#.#..#..##..##...#...####..........#...#...###.#.#..#...#..###.##.#.##..
...#...#.#...#..#.#.###.#.#.#.#..##..##.#######...#.######....#.#.###.#.#.##.#.#.###.###.##.###..###
#.##....#.#.....#..###..#####.#..#..##.###....#.###....#.#####.###.#.######.....#..#.#..###..#.....#
....#..#..#.#.....#####.....###.....##.##.#..##....#...#...###...#..##..#..#####..##.#.#..#.#...####
#.#####...#.##..#..##..#.##.#..##........#...#....#.#....###.#.#...##.##.#####..###..##.#.#.#.#.####
#.###.####.#...#..##########..#.###..#.#.###...#.##..#####.###..#..###....##.##...#..###.##.#..#.##.
##.######.###.#...##..###.#.#.#.###.#.##....####..#.#.###.#...#..##.#####...##..###.#..##..####.....
#.#.....##...#.###.#.###.#.##.#.###....#.##.....##....####.####.##.#...#.....#..#####..#.#....###.##
###..##.#....####.#####.#.#..#..#....###.###.#..####.#.####..###.#.#...###.##........#.#####.#.##..#
##.#.###.###.......###.#.##.#..#.##.####.###....#..#.#.#...##....##..#....###.#####..###...##.#.##..
.#..###.#...#...#..#..##...##.#...#######...#..#.##..####..##...##.##.##.###.####...##.....#...#.###
#.##.........##..#..###..#....#.###..##..#.##.....##.###.....##..#.#.#######...#...#.....#..##..#..#
##..#.###.#...#.##...#.#..###.##...#...#####.####...###.#..##.##..#.##.#.#..#####.#...##..####...#..
..#.#.........#####.##..###.#.#.#..#.##...##.#..##.#..####.##.#.###.#.#.###.##...#.##....#.#######.#
###..#..#.#.#...#.###.#####.#.#.######.....##.#.##.#.#...#..#.#.##..###.#..###.####...##..####......
#..#..#.#....###.#.##..#.#.#.#.##..#..##.......#..#.#.......##...####.#.#..###...........#...#.#.#.#
#....##..##..#.##...###.#..#.#####.#.#.###.#.#..######.....#.#####....#.#..####..#.##.#####..#...#..
.##.###..##......###.....#.#.##...#..####.#..#...#..###.####.#..####.#...#.######.#.#..#####.....##.
#...###.###...##.#####..###.###.#####.###.#..###.#..#######..#..#####....#..##...######...##.#....##
###.#.#.#.#####..#####.#..##.#.###...####.#.#.#..#.#......#...#....#...#.#..#..#...#...##..#..##..##
.####....##..##.###..#.######...#.#..#.##..#..##.###.#.##.#...###.#.#.#....#.####.#.#....##.#####..#
##..##...###.#.#.#####..#.##..#####.####.##.#..#..####..#..##.##..###..###.....#.#.#.#####...#.###.#
###.####.##....#.##.#....#..###..##.##..#.....#.###....#.######...##.....#.##.##..###.####.#.###.#.#
#.#....#.#.#.#.#..##.##.##..##..##..####.#.#.#..##.#####..#####...#.#..##....#######.###..##..######
.#.....#.#..####.###..###...###.##....#.#.#.#..##.##...##..#.########..#.#...#..#.#..#.##.#.#.###.#.
#..#.####..####.##..##.##..#..##.####..#..##...#.##..#..#.###.#....#####..##.#######.#.###..#.#....#
.##.#....####....#.##.###..#..#..###.#.#.##.#..##.###....#######.####..#.########.#.....##.#...##..#
#.###..#.#.........#.#.#....########.####..###......##..#.##.#.#..######.#.###..#...####...##.##.#..
#.###.#..###...##.#......##..#..##.#..###..#.####...#.#..#...#.#####..##.###..##.##.#.#...#.#...#.##
##.###..#..#.#.##.##.##...###..#..#.#.#..#...###..#.#...#..#####.####...########.#...#.#.#.###.##...
.#####..#..#..####.#..#.....##.##....###...##.####.#.####.#..#####..#.#..#.##.###.#..##..###..#..#..
.#.#....#.####.#.###.#.###.####.#.##.#......##...#...#..###.###.#..##...#.#.#..##.##.#####.##.###..#
.##..###.##..#####.##.#....###...##....##..###.##.########.#.....#..##..#...#.#.#.###..#...#.#.#...#
#.####...####.###.#.#.###.###.#####.#...###.####..#..#..####.###..#.#..#.##.###..#.......#.#..##.#..
...#.###....#...###.#.###.#.#.#...#.##......#..###..###.#.#.#..###.##..#.#.#..#..##..#.#..###.##.#.#
#..#....#..####....####...#..######.#.#..##.#.##.###.#.#..##.#.....###..#....##......##.####..#.#..#
##..##......#..##..#..##.##.##..#..#.#...####.#.##...##.#.##.#..#...##..##.##..#..####..#..#..#..##.
#.####.#######.....##.#..##....#..#.#......###..##.##..##..#.#.#.#..##..#.#.....#......#.#.#.#....#.
....##.###...#...###..#..#.##...#.#.#.##...##....####..#..##..#.##.##...##..##....#...###.#.##....#.
..#..###.#.###.#.#.#...####...###.#..#.#.#...#.#.......##..#....##..#.##.##..##..#..####.#.#.......#
##.##.##.#....#.#..###.####..##..#..######..#.###.###.#####......#.#...#.#.....#####...#....#.###...
.#...##.##.#..#.##..###..#.######...#..#....#.#....#..###....#.#.#.##...#####.#..#...#..#..###......
.#......####....#.#...#.#.##.###.#..#..####.#...####..#####.##.#...#.#.#.##.##...#.#.#.##.#.##...###
..###..#####.#....##..#..#.###...#..##..##.#......#..####.#.###.#...#....###.#.##..####.#.####.###..
..##..#.#.#.#.##.####...#..#..#..#.##..#...##.#.##.#.###.###.#.#.##...#.#######.#.#.....####........
##.###.#.#.#..#..##..##.##.##.###...#...##..#.##.....#.#..#.##.#.#.###...##.####..##..##..#.#....#..
..#.##.#.##.###...###..#..#...##....#..#......####.##...#####...#...#.####.##.###.....#..#.#..##.##.
#..######.#.#..##...##.#.#..##...##.####.#######..#..#..###.##..#..#...#....#..#.##....###...#.#.##.
..#.#.#....####.#.#.........#..#.#..##..####...#.####...#..#.#...###.####..##......#..#...#.##.##.#.
.####.##..##.####..#.#.##..####.#.#......##.##...####.####.#..#...##.#..######.#.##.#.##.##.#.#.##.#
.#....##...#..###..#.#..#.##..#.####.#..###..##..#####..#..#.#.##..#.....#..###.....###.#.##.#.##.#.
...##...#...#..#..........#######......##.##.#.##.##.#..#.##.###.###..#..#....##..#.###.#..#...#####
.#####...#.##.....####.###.#.#..#....#...##..#....###.#.##.##########.#.#...#.####.......#..#...#.#.
.#....#.####.##.#.###..#.###.#....#.###..##...###...#.....###..####...#..##.#..##.#....###.#....#.#.
.##..###........#.#.##..##.##.##..#..####.#.#.##.##.#..#.#..#######.....######.#.#..#..###....#.##.#
..#.##..#...##.######..#..##.###...#.#.####..####..#.#...#.....##...##.#..##.#..#..#.###.##..#.#....
..#.###.###.#..#####....#...#..#...#..#.##..##..#.####..#..#.##.#.##..#######...##.#.#.#..#.##..###.
###.##..#..#...#####.#....#.#...#..###..##...##...#...#...#.###.#..#..#########..##.....#....#.#...#
#..##.#....#..####..###.#.#.#.##.###.#..#.###.##....##.#.#..#..#.#.#..###..##.#.#.#..#..#.#.###..###
#.#.#.###..#.#.#.....###.#.#....#.#####....##.###.##....#.......#..###.#.#..###..####.#.....####....
#####.####.#.#..#####.#.#....#....#......####.####.#.###.##..#...#.#..##.##.#########.###.#.#.#.#.##
.....#.##.##.#####...#.##...#...##########.###....##..####...#..####.##..###.#.#######.##...##.###..
#.#..##..#..##...........####.#....##.##.#..#.##..####.#..#.#..#...#...###.###.#...##.#.#.##.#..###.
.#####.#.#.#######.##..#..#..#..###.###.#..####..#.##....#.#..#.##.##.##.#########......####..#.##.#
.#....###..#.###.##.#...#.#...#...#.####...#.......#..###..####.####..#.####.##.#.##...###.###....#.
##......##.....#####.#.#.#......#.#.#.#.###.######.....#.##.#..#.#######.###.########..####..#.###.#
###.##....###..#.#####..#..####..#.......##.##.#.##.#.#.#.#..#......####..###..####.##.#.......#.#.#
#..###.###..#..##.#####.##.#....##.###.###....#######.#...#.#.#.#..#######...#.....#..##.####.###.##`;
const inputImgEx = `#..#.
#....
##..#
..#..
..###`;

const algo = inputAlgo.split('').map(i => i === '#' ? 1 : 0);
let img = inputImg.split('\n').map(r => r.split('').map(i => i === '#' ? 1 : 0));

const numIterations = 50;

// buffer 5 pixels on all sides
for (let i=0; i<numIterations+1; i++) {
    img.splice(0, 0, new Array(img[0].length).fill(0));
    img.push(new Array(img[0].length).fill(0));
}

for (let y=0; y<img.length; y++) {
    for (let i=0; i<numIterations+1; i++) {
        img[y].splice(0, 0, 0);
        img[y].push(0);
    }
}

function applyAlgo(iteration: number) {
    // copy
    let newImg: (0|1)[][] = [];
    for (let y=0; y<img.length; y++) {
        newImg.push(new Array(img[y].length).fill(0));
    }

    const ptOffsets = [
        [-1, -1], [0, -1], [1, -1],
        [-1, 0], [0, 0], [1, 0],
        [-1, 1], [0, 1], [1, 1],
    ];

    for (let y=0; y<img.length; y++) {
        for (let x=0; x<img[0].length; x++) {
            let val = 0;
            for (const ptO of ptOffsets) {
                val <<= 1;
                const xO = x + ptO[0];
                const yO = y + ptO[1];
                val |= (xO < 0 || yO < 0 || xO >= img[0].length || yO >= img.length) ? ((algo[0] === 1) ? (iteration & 1) : 0) : img[yO][xO];
            }
            newImg[y][x] = algo[val];
        }
    }

    img = newImg;
}

for (let i=0; i<numIterations; i++) {
    applyAlgo(i);
}

let count=0;
for (let y=0; y<img.length; y++) {
    for (let x=0; x<img[0].length; x++) {
        if (img[y][x] === 1) {
            count++;
        }
    }
}

console.log(count);
